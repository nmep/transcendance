input {
  tcp {
    port => 514
    type => "syslog"
  }
}

filter {
    json {
      source => "message"
    }
  # Nettoyage des champs inutiles
    mutate {
      remove_field => ["event", "host", "@version", "app"]
    }

  # Si le champ service est vide ou manquant, on le supprime pour Ã©viter les erreurs d'indexation
    if ![service] {
      drop { }
    }
}


output {
  elasticsearch {
    hosts => ["https://elasticsearch:9200"]  # Adaptez l'URL si nÃ©cessaire
    index => "%{service}-%{+YYYY.MM.dd}"
    user => "${ELASTIC_USER}"
    password => "${ELASTIC_PASSWORD}"
    ssl_enabled => true
    ssl_certificate_authorities => "/usr/share/logstash/certs/ca/ca.crt"
    }
  stdout {
    codec => rubydebug
  }
}
